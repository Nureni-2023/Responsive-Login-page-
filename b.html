<!DOCTYPE HTML>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Login</title>

<!-- External Styles -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="../assets/styles/bootstrap.css">
<link rel="stylesheet" href="../assets/fonts/css/fontawesome-all.min.css">

<link rel="manifest" href="../assets/scripts/_manifest.json">
<link rel="apple-touch-icon" href="../../assets/img/favicon.png">
<link rel="icon" type="image/png" href="../../assets/img/favicon.png" />

<?php if(isset($_SESSION['loginId'])){echo "<script>window.location.href='../home/';</script>"; } ?>

<style>
    body {
        margin: 0;
        padding: 0;
        background: linear-gradient(145deg, #eef4ff, #dde6f7);
        font-family: 'Inter', sans-serif;
        display: flex;
        align-items: center;
        justify-content: center;
        height: 100vh;
    }

    .login-wrapper {
        background: #fff;
        padding: 40px 30px;
        border-radius: 20px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15), 0 6px 20px rgba(0, 0, 0, 0.1);
        width: 100%;
        max-width: 400px;
        transition: all 0.3s ease;
    }

    .login-wrapper h2 {
        font-size: 22px;
        font-weight: 700;
        margin-bottom: 10px;
        color: #111;
    }

    .login-wrapper p {
        font-size: 14px;
        color: #555;
        margin-bottom: 20px;
    }

    .login-wrapper a {
        color: #4e60ff;
        text-decoration: none;
        font-weight: 500;
    }

    .form-control {
        height: 50px;
        border-radius: 12px;
        border: 1px solid #ccc;
        padding-left: 15px;
        font-size: 14px;
        box-shadow: inset 2px 2px 5px rgba(0, 0, 0, 0.05);
        transition: all 0.3s ease;
    }

    .form-control:focus {
        border-color: #4e60ff;
        box-shadow: 0 0 8px #b3b9ff, inset 1px 1px 3px rgba(0, 0, 0, 0.05);
        outline: none;
    }

    .btn-login {
        background: linear-gradient(145deg, #4e60ff, #6a79ff);
        color: #fff;
        border: none;
        width: 100%;
        height: 50px;
        border-radius: 12px;
        font-weight: 600;
        font-size: 16px;
        margin-top: 20px;
        box-shadow: 0 6px 15px rgba(78, 96, 255, 0.4);
        transition: all 0.3s ease;
    }

    .btn-login:hover {
        box-shadow: 0 8px 18px rgba(78, 96, 255, 0.6);
        transform: translateY(-2px);
    }

    .text-link {
        text-align: center;
        font-size: 14px;
        margin-top: 15px;
    }

    .logo {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 30px;
    }

    .logo img {
        height: 32px;
    }

    .logo span {
        font-size: 20px;
        font-weight: 700;
    }

    #preloader {
        position: fixed;
        top: 0; left: 0;
        width: 100%;
        height: 100%;
        background: rgba(255,255,255,0.7);
        z-index: 9999;
        display: flex;
        align-items: center;
        justify-content: center;
    }
</style>
</head>

<body>

<div id="preloader"><div class="spinner-border text-primary" role="status"></div></div>

<div class="login-wrapper">
    <div class="logo">
        <img src="../../assets/img/logodark.png?v=1.1" alt="Logo">
        <span><span style="color:#000">Aspfiy</span><span style="color:#4e60ff;">VTU</span></span>
    </div>

    <h2>User Login</h2>
    <p>Don't have an account? <a href="../register/">Register</a></p>

    <form id="login-form" method="post">
        <div class="mb-3">
            <input type="text" class="form-control" id="phonelogin" name="phone" placeholder="Email or Phone" required readonly>
        </div>
        <div class="mb-3">
            <input type="password" class="form-control" id="passwordlogin" name="password" placeholder="Password" required readonly>
        </div>
        <div class="text-end mb-2">
            <a href="../recovery/">Reset Password</a>
        </div>
        <button type="submit" class="btn-login" id="submit-btn">Log In</button>
    </form>
</div>

<!-- Scripts -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="../assets/scripts/bootstrap.min.js"></script>
<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
<script src="../assets/scripts/custom.js"></script>

<script>
$(document).ready(function () {
    checkIfPhoneNumberSaved();

    $("#phonelogin").click(function () { $(this).removeAttr("readonly"); });
    $("#passwordlogin").click(function () { $(this).removeAttr("readonly"); });

    $('#login-form').submit(function (e) {
        e.preventDefault();
        $('#submit-btn').html('<i class="fa fa-spinner fa-spin"></i> Logging in...');
        $('#submit-btn').attr('disabled', true);

        $.ajax({
            url: '../home/includes/route.php?login',
            data: new FormData(this),
            cache: false,
            contentType: false,
            processData: false,
            method: 'POST',
            success: function (resp) {
                resp = JSON.parse(resp);
                if (resp.status === "success") {
                    swal("Success!", "Login Successful", "success");
                    setTimeout(function () {
                        location.replace('../home/')
                    }, 1000);
                } else {
                    swal("Error", resp.msg, "error");
                }
                $('#submit-btn').html("Log In").attr('disabled', false);
            }
        });
    });
});

function checkIfPhoneNumberSaved() {
    let $phone = atob(unescape(getCookie("loginPhone")));
    let $name = atob(unescape(getCookie("loginName")));
    if ($phone) {
        $("#phonelogin").val($phone);
    }
}

function getCookie(name) {
    let cname = name + "=";
    let decodedCookie = decodeURIComponent(document.cookie);
    let ca = decodedCookie.split(';');
    for (let i = 0; i < ca.length; i++) {
        let c = ca[i];
        while (c.charAt(0) == ' ') c = c.substring(1);
        if (c.indexOf(cname) == 0) return c.substring(cname.length, c.length);
    }
    return "";
}
</script>

</body>
</html>
